
# Mutation signature fitting:
### Overview:
These scripts are used to fit mutation signatures to the 1-mer and 3-mer mutation spectra using [`sigfit`](https://rdrr.io/github/kgori/sigfit/man/) and carry out the Mantel test to compare the phylogenetic signal of reconstructed mutation spectra to empirical spectra. The scripts were used to generate Figures 6 and 7 of the paper, along with mutation-signature related supplemental figures.

#### Step 0: convert spectra to sig-fit style input
The script `Step_0_generateDataForSigfit.fullSpectra.R` was used to generate input for `sigfit`. It takes in all species/populations 7-mer spectra and collapses them down to 1-mer and 3-mer spectra, carries out human genome content rescaling (no downsampling), and formats the output to be able to used as input for `sigfit`. 

To match COSMIC signature conventions, 3-mers that in our dataset have an ancestral "A" are reverse complemented (e.g. AAC>ATC becomes GTT>GAT) since COSMIC uses "T" and "C" as the ancestral states, rather than "A" and "C" in our dataset. The 1-mer spectrum does not need to be reverse complemented as it is not used with COSMIC signatures.


###### input files: 
* `allSpectra.PopulationLevel.BasedOn5individualsPerPop.notprojected.usethis.txt`: 7-mer spectra for all species/populations. (on Dryad; inside the mutyperOutput_7mer.tar.gz directory.) This file the 7-mer spectra counts output from mutyper, concatenated across all species and sub-populations. Includes populations and species that get excluded by this script as they are not part of main text results (including ucla_wolves and sub-populations that weren't part of main text analyses).

* genomic targets: from species-specific mutyper_targets directories in `mutyperOutput7mer.tar.gz` on Dryad 

#### Step 1: Signature fitting 
The script `Step_1_FitAPrioriSignatures.UsingSigfit.EXCLUDECpG.TpGs.ModelsForManuscript` was used to carry out signature fitting and extraction using `sigfit`, including fitting aging signatures extracted from extracted from Jonsson et al. (2017) to the 1-mer spectra and COSMIC signatures SBS1+SBS5 to the 3-mer spectra (see paper Methods and SI Methods for details). More complex models were then fit in which additional novel signatures were extracted and fit to the data in addition to the *a priori* signatures. 
The script also carries out the Mantel test on the correlation between the distances between species reconstructed mutation spectra and their phylogenetic distance.

Additional details in SI Methods.

###### main input files:
* `all_spectra_1mer_Matrix_notdownsampled.notprojected.RESCALEDBYHUMANTARGETS_READYFORSIGFIT.separateCpGs.yes.txt`: 1-mer (separated CpG>TpG) spectra (human-target rescaled) in sigfit format (generated by `step 0`, but provided here for convenience)
* `all_spectra_3mer_Matrix_notdownsampled.notprojected.RESCALEDBYHUMANTARGETS_READYFORSIGFIT.txt`: 3-mer spectra (human-target rescaled) in sigfit format (generated by `step 0`, but provided here for convenience)
* `jonsson.agingsignatures.tables9.convertedtoproportionsinexcel.REVCOMP.REORDEREDTOMATCHMYDATA.YOUNGPARENTCALCAT13.notintercept.txt`: a table containing the maternal (maternal_age), paternal (paternal_age) and 'young parent' (young_parent_13) aging signatures that we derived from the Poisson regressions in Jonsson et al's Table S9 (details in SI Methods of the paper) and used for fitting aging signatures to our mammal spectrum data with sigfit. Columns represent each of the 7 mutation types in the 1-mer+CpG spectrum (A>C, A>T, A>G, C>T (nonCpG), CpG>TpG, C>G and C>A) and values represent the proportion of each spectrum made up of each mutation type. Note that when fitting these signatures to sigfit, the CpG>TpG category was excluded and the proportions rescaled to sum to 1 for each signature without that category. (provided here for convenience, and on Dryad)
    * Jónsson, Hákon, et al. "Parental influence on human germline de novo mutations in 1,548 trios from Iceland." Nature 549.7673 (2017): 519-522.

###### input files for running Mantel test (not needed if just signature fitting):
* `pairwise.phylogeneticDistance.raxmltree.txt`: pairwise distances from phylogenetic tree (produced by 3_PhyloSignalOfSpectra_and_Enrichments/ scripts) (provided here for convenience)

* `speciesCodes.txt`: species Latin names for matching with phylogenetic tree (provided here for convenience)

* `RAxML_bipartitions.result_FIN4_raw_rooted_wBoots_4098mam1out_OK.newick`: RAXML tree from Upham et al. (2019) - this contains all the species from Upham et al. and gets subset to the species in our study during this script. Branch lengths represent expected substitutions (in phylogenetic_trees.tar.gz directory on Dryad)
     * Upham, Nathan S., Jacob A. Esselstyn, and Walter Jetz. "Inferring the mammal tree: species-level sets of phylogenies for questions in ecology, evolution, and conservation." PLoS biology 17.12 (2019): e3000494.

#### Step 2: Overlay reconstructed and empirical pairwise distance results
In this step, the script `Step_2_overlayMantelTestResultPlots` was used to overlay Mantel test results from `step 1` based on reconstructed species' spectra are overlaid with original results based on empirical spectra (from the 3_PhyloSignalOfSpectra_and_Enrichments/ scripts) to see how well the phylogenetic signal of the reconstructed spectra compares to that of the empirical spectra.
